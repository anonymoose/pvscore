/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

GraphicalViewer=function(id){try{Workflow.call(this,id);this.factory=null;this.model=null;this.initDone=false;}catch(e){pushErrorStack(e,"GraphicalViewer=function(/*:String*/ id)");}};GraphicalViewer.prototype=new Workflow();GraphicalViewer.prototype.type="GraphicalViewer";GraphicalViewer.prototype.setEditPartFactory=function(_e3b){this.factory=_e3b;this.checkInit();};GraphicalViewer.prototype.setModel=function(_e3c){try{if(_e3c instanceof AbstractObjectModel){this.model=_e3c;this.checkInit();this.model.addPropertyChangeListener(this);}else{alert("Invalid model class type:"+_e3c.type);}}catch(e){pushErrorStack(e,"GraphicalViewer.prototype.setModel=function(/*:AbstractObjectModel*/ model )");}};GraphicalViewer.prototype.propertyChange=function(_e3d){switch(_e3d.property){case AbstractObjectModel.EVENT_ELEMENT_REMOVED:var _e3e=this.getFigure(_e3d.oldValue.getId());this.removeFigure(_e3e);break;case AbstractObjectModel.EVENT_ELEMENT_ADDED:var _e3e=this.factory.createEditPart(_e3d.newValue);_e3e.setId(_e3d.newValue.getId());this.addFigure(_e3e);this.setCurrentSelection(_e3e);break;}};GraphicalViewer.prototype.checkInit=function(){if(this.factory!==null&&this.model!==null&&this.initDone==false){try{var _e3f=this.model.getModelChildren();var _e40=_e3f.getSize();for(var i=0;i<_e40;i++){var _e42=_e3f.get(i);var _e43=this.factory.createEditPart(_e42);_e43.setId(_e42.getId());this.addFigure(_e43);}}catch(e){pushErrorStack(e,"GraphicalViewer.prototype.checkInit=function()[addFigures]");}try{var _e44=this.getDocument().getFigures();var _e40=_e44.getSize();for(var i=0;i<_e40;i++){var _e43=_e44.get(i);if(_e43 instanceof Node){this.refreshConnections(_e43);}}}catch(e){pushErrorStack(e,"GraphicalViewer.prototype.checkInit=function()[refreshConnections]");}}};GraphicalViewer.prototype.refreshConnections=function(node){try{var _e46=new ArrayList();var _e47=node.getModelSourceConnections();var _e48=_e47.getSize();for(var i=0;i<_e48;i++){var _e4a=_e47.get(i);_e46.add(_e4a.getId());var _e4b=this.getLine(_e4a.getId());if(_e4b===null){_e4b=this.factory.createEditPart(_e4a);var _e4c=_e4a.getSourceModel();var _e4d=_e4a.getTargetModel();var _e4e=this.getFigure(_e4c.getId());var _e4f=this.getFigure(_e4d.getId());var _e50=_e4e.getOutputPort(_e4a.getSourcePortName());var _e51=_e4f.getInputPort(_e4a.getTargetPortName());_e4b.setTarget(_e51);_e4b.setSource(_e50);_e4b.setId(_e4a.getId());this.addFigure(_e4b);this.setCurrentSelection(_e4b);}}var _e52=node.getOutputPorts();_e48=_e52.getSize();for(var i=0;i<_e48;i++){var _e53=_e52.get(i).getConnections();var _e54=_e53.getSize();for(var ii=0;ii<_e54;ii++){var _e56=_e53.get(ii);if(!_e46.contains(_e56.getId())){this.removeFigure(_e56);_e46.add(_e56.getId());}}}}catch(e){pushErrorStack(e,"GraphicalViewer.prototype.refreshConnections=function(/*:Node*/ node )");}};
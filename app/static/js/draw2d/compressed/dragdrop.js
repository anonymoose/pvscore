/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Drag=function(){};Drag.current=null;Drag.currentTarget=null;Drag.currentHover=null;Drag.currentCompartment=null;Drag.dragging=false;Drag.isDragging=function(){return this.dragging;};Drag.setCurrent=function(_c3d){this.current=_c3d;this.dragging=true;};Drag.getCurrent=function(){return this.current;};Drag.clearCurrent=function(){this.current=null;this.dragging=false;this.currentTarget=null;};Draggable=function(_c3e,_c3f){this.id=UUID.create();this.node=null;EventTarget.call(this);this.construct(_c3e,_c3f);this.diffX=0;this.diffY=0;this.targets=new ArrayList();};Draggable.prototype=new EventTarget();Draggable.prototype.construct=function(_c40){if(_c40===null||_c40===undefined){return;}this.element=_c40;var _c41=this;var _c42=function(){var _c43=new DragDropEvent();_c43.initDragDropEvent("dblclick",true);_c41.dispatchEvent(_c43);var _c44=arguments[0]||window.event;_c44.cancelBubble=true;_c44.returnValue=false;};var _c45=function(){var _c46=arguments[0]||window.event;var _c47=new DragDropEvent();if(_c41.node!==null){var _c48=_c41.node.getWorkflow().getAbsoluteX();var _c49=_c41.node.getWorkflow().getAbsoluteY();var _c4a=_c41.node.getWorkflow().getScrollLeft();var _c4b=_c41.node.getWorkflow().getScrollTop();_c47.x=_c46.clientX-_c41.element.offsetLeft+_c4a-_c48;_c47.y=_c46.clientY-_c41.element.offsetTop+_c4b-_c49;}if(_c46.button===2){_c47.initDragDropEvent("contextmenu",true);_c41.dispatchEvent(_c47);}else{_c47.initDragDropEvent("dragstart",true);if(_c41.dispatchEvent(_c47)){_c41.diffX=_c46.clientX-_c41.element.offsetLeft;_c41.diffY=_c46.clientY-_c41.element.offsetTop;Drag.setCurrent(_c41);if(_c41.isAttached==true){_c41.detachEventHandlers();}_c41.attachEventHandlers();}}_c46.cancelBubble=true;_c46.returnValue=false;};var _c4c=function(){if(Drag.getCurrent()===null){var _c4d=arguments[0]||window.event;if(Drag.currentHover!==null&&_c41!==Drag.currentHover){var _c4e=new DragDropEvent();_c4e.initDragDropEvent("mouseleave",false,_c41);Drag.currentHover.dispatchEvent(_c4e);}if(_c41!==null&&_c41!==Drag.currentHover){var _c4e=new DragDropEvent();_c4e.initDragDropEvent("mouseenter",false,_c41);_c41.dispatchEvent(_c4e);}Drag.currentHover=_c41;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_c4c,false);this.element.addEventListener("mousedown",_c45,false);this.element.addEventListener("dblclick",_c42,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_c4c);this.element.attachEvent("onmousedown",_c45);this.element.attachEvent("ondblclick",_c42);}else{throw "Drag not supported in this browser.";}}};Draggable.prototype.onDrop=function(_c4f,_c50){};Draggable.prototype.attachEventHandlers=function(){var _c51=this;_c51.isAttached=true;this.tempMouseMove=function(){var _c52=arguments[0]||window.event;var _c53=new Point(_c52.clientX-_c51.diffX,_c52.clientY-_c51.diffY);if(_c51.node!==null&&_c51.node.getCanSnapToHelper()){_c53=_c51.node.getWorkflow().snapToHelper(_c51.node,_c53);}_c51.element.style.left=_c53.x+"px";_c51.element.style.top=_c53.y+"px";if(_c51.node!==null){var _c54=_c51.node.getWorkflow().getScrollLeft();var _c55=_c51.node.getWorkflow().getScrollTop();var _c56=_c51.node.getWorkflow().getAbsoluteX();var _c57=_c51.node.getWorkflow().getAbsoluteY();var _c58=_c51.getDropTarget(_c52.clientX+_c54-_c56,_c52.clientY+_c55-_c57);var _c59=_c51.getCompartment(_c52.clientX+_c54-_c56,_c52.clientY+_c55-_c57);if(Drag.currentTarget!==null&&_c58!=Drag.currentTarget){var _c5a=new DragDropEvent();_c5a.initDragDropEvent("dragleave",false,_c51);Drag.currentTarget.dispatchEvent(_c5a);}if(_c58!==null&&_c58!==Drag.currentTarget){var _c5a=new DragDropEvent();_c5a.initDragDropEvent("dragenter",false,_c51);_c58.dispatchEvent(_c5a);}Drag.currentTarget=_c58;if(Drag.currentCompartment!==null&&_c59!==Drag.currentCompartment){var _c5a=new DragDropEvent();_c5a.initDragDropEvent("figureleave",false,_c51);Drag.currentCompartment.dispatchEvent(_c5a);}if(_c59!==null&&_c59.node!=_c51.node&&_c59!==Drag.currentCompartment){var _c5a=new DragDropEvent();_c5a.initDragDropEvent("figureenter",false,_c51);_c59.dispatchEvent(_c5a);}Drag.currentCompartment=_c59;}var _c5b=new DragDropEvent();_c5b.initDragDropEvent("drag",false);_c51.dispatchEvent(_c5b);};_c51.tempMouseUp=function(){_c51.detachEventHandlers();var _c5c=arguments[0]||window.event;if(_c51.node!==null){var _c5d=_c51.node.getWorkflow().getScrollLeft();var _c5e=_c51.node.getWorkflow().getScrollTop();var _c5f=_c51.node.getWorkflow().getAbsoluteX();var _c60=_c51.node.getWorkflow().getAbsoluteY();var _c61=_c51.getDropTarget(_c5c.clientX+_c5d-_c5f,_c5c.clientY+_c5e-_c60);var _c62=_c51.getCompartment(_c5c.clientX+_c5d-_c5f,_c5c.clientY+_c5e-_c60);if(_c61!==null){var _c63=new DragDropEvent();_c63.initDragDropEvent("drop",false,_c51);_c61.dispatchEvent(_c63);}if(_c62!==null&&_c62.node!==_c51.node){var _c63=new DragDropEvent();_c63.initDragDropEvent("figuredrop",false,_c51);_c62.dispatchEvent(_c63);}if(Drag.currentTarget!==null){var _c63=new DragDropEvent();_c63.initDragDropEvent("dragleave",false,_c51);Drag.currentTarget.dispatchEvent(_c63);Drag.currentTarget=null;}}var _c64=new DragDropEvent();_c64.initDragDropEvent("dragend",false);_c51.dispatchEvent(_c64);_c51.onDrop(_c5c.clientX,_c5c.clientY);Drag.currentCompartment=null;Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _c68=this.targets.get(i);if(_c68.node.isOver(x,y)&&_c68.node!==this.node){return _c68;}}return null;};Draggable.prototype.getCompartment=function(x,y){var _c6b=null;for(var i=0;i<this.node.getWorkflow().compartments.getSize();i++){var _c6d=this.node.getWorkflow().compartments.get(i);if(_c6d.isOver(x,y)&&_c6d!==this.node){if(_c6b===null){_c6b=_c6d;}else{if(_c6b.getZOrder()<_c6d.getZOrder()){_c6b=_c6d;}}}}return _c6b===null?null:_c6b.dropable;};Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};Draggable.prototype.getTop=function(){return this.element.offsetTop;};DragDropEvent=function(){AbstractEvent.call(this);};DragDropEvent.prototype=new AbstractEvent();DragDropEvent.prototype.initDragDropEvent=function(_c6e,_c6f,_c70){this.initEvent(_c6e,_c6f);this.relatedTarget=_c70;};DropTarget=function(_c71){EventTarget.call(this);this.construct(_c71);};DropTarget.prototype=new EventTarget();DropTarget.prototype.construct=function(_c72){this.element=_c72;};DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!==null){ol+=el.offsetLeft;}return ol;};DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!==null){ot+=el.offsetTop;}return ot;};DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};
/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

SnapToGeometry=function(_4de){SnapToHelper.call(this,_4de);this.rows=null;this.cols=null;};SnapToGeometry.prototype=new SnapToHelper();SnapToGeometry.THRESHOLD=5;SnapToGeometry.prototype.snapPoint=function(_4df,_4e0,_4e1){if(this.rows===null||this.cols===null){this.populateRowsAndCols();}if((_4df&SnapToHelper.EAST)!==0){var _4e2=this.getCorrectionFor(this.cols,_4e0.getX()-1,1);if(_4e2!==SnapToGeometry.THRESHOLD){_4df&=~SnapToHelper.EAST;_4e1.x+=_4e2;}}if((_4df&SnapToHelper.WEST)!==0){var _4e3=this.getCorrectionFor(this.cols,_4e0.getX(),-1);if(_4e3!==SnapToGeometry.THRESHOLD){_4df&=~SnapToHelper.WEST;_4e1.x+=_4e3;}}if((_4df&SnapToHelper.SOUTH)!==0){var _4e4=this.getCorrectionFor(this.rows,_4e0.getY()-1,1);if(_4e4!==SnapToGeometry.THRESHOLD){_4df&=~SnapToHelper.SOUTH;_4e1.y+=_4e4;}}if((_4df&SnapToHelper.NORTH)!==0){var _4e5=this.getCorrectionFor(this.rows,_4e0.getY(),-1);if(_4e5!==SnapToGeometry.THRESHOLD){_4df&=~SnapToHelper.NORTH;_4e1.y+=_4e5;}}return _4df;};SnapToGeometry.prototype.snapRectangle=function(_4e6,_4e7){var _4e8=_4e6.getTopLeft();var _4e9=_4e6.getBottomRight();var _4ea=this.snapPoint(SnapToHelper.NORTH_WEST,_4e6.getTopLeft(),_4e8);_4e7.x=_4e8.x;_4e7.y=_4e8.y;var _4eb=this.snapPoint(SnapToHelper.SOUTH_EAST,_4e6.getBottomRight(),_4e9);if(_4ea&SnapToHelper.WEST){_4e7.x=_4e9.x-_4e6.getWidth();}if(_4ea&SnapToHelper.NORTH){_4e7.y=_4e9.y-_4e6.getHeight();}return _4ea|_4eb;};SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=[];this.cols=[];var _4ec=this.workflow.getDocument().getFigures();var _4ed=0;for(var i=0;i<_4ec.getSize();i++){var _4ef=_4ec.get(i);if(_4ef!=this.workflow.getCurrentSelection()){var _4f0=_4ef.getBounds();this.cols[_4ed*3]=new SnapToGeometryEntry(-1,_4f0.getX());this.rows[_4ed*3]=new SnapToGeometryEntry(-1,_4f0.getY());this.cols[_4ed*3+1]=new SnapToGeometryEntry(0,_4f0.x+(_4f0.getWidth()-1)/2);this.rows[_4ed*3+1]=new SnapToGeometryEntry(0,_4f0.y+(_4f0.getHeight()-1)/2);this.cols[_4ed*3+2]=new SnapToGeometryEntry(1,_4f0.getRight()-1);this.rows[_4ed*3+2]=new SnapToGeometryEntry(1,_4f0.getBottom()-1);_4ed++;}}};SnapToGeometry.prototype.getCorrectionFor=function(_4f1,_4f2,side){var _4f4=SnapToGeometry.THRESHOLD;var _4f5=SnapToGeometry.THRESHOLD;for(var i=0;i<_4f1.length;i++){var _4f7=_4f1[i];var _4f8;if(_4f7.type===-1&&side!==0){_4f8=Math.abs(_4f2-_4f7.location);if(_4f8<_4f4){_4f4=_4f8;_4f5=_4f7.location-_4f2;}}else{if(_4f7.type===0&&side===0){_4f8=Math.abs(_4f2-_4f7.location);if(_4f8<_4f4){_4f4=_4f8;_4f5=_4f7.location-_4f2;}}else{if(_4f7.type===1&&side!==0){_4f8=Math.abs(_4f2-_4f7.location);if(_4f8<_4f4){_4f4=_4f8;_4f5=_4f7.location-_4f2;}}}}}return _4f5;};SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};
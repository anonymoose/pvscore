/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

Workflow=function(id){try{if(!id){return;}this.menu=null;this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;this.snapToGeometryHelper=null;this.figures=new ArrayList();this.lines=new ArrayList();this.commonPorts=new ArrayList();this.dropTargets=new ArrayList();this.compartments=new ArrayList();this.selectionListeners=new ArrayList();this.dialogs=new ArrayList();this.toolPalette=null;this.dragging=false;this.tooltip=null;this.draggingLine=null;this.draggingLineCommand=null;this.commandStack=new CommandStack();this.oldScrollPosLeft=0;this.oldScrollPosTop=0;this.currentSelection=null;this.currentMenu=null;this.connectionLine=new Line();this.resizeHandleStart=new LineStartResizeHandle(this);this.resizeHandleEnd=new LineEndResizeHandle(this);this.resizeHandle1=new ResizeHandle(this,1);this.resizeHandle2=new ResizeHandle(this,2);this.resizeHandle3=new ResizeHandle(this,3);this.resizeHandle4=new ResizeHandle(this,4);this.resizeHandle5=new ResizeHandle(this,5);this.resizeHandle6=new ResizeHandle(this,6);this.resizeHandle7=new ResizeHandle(this,7);this.resizeHandle8=new ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);Canvas.call(this,id);this.setPanning(false);if(this.html!==null){this.html.style.backgroundImage="url(grid_10.png)";this.html.className="Workflow";oThis=this;this.html.tabIndex="0";var _1192=function(){var _1193=arguments[0]||window.event;_1193.cancelBubble=true;_1193.returnValue=false;_1193.stopped=true;var diffX=_1193.clientX;var diffY=_1193.clientY;var _1196=oThis.getScrollLeft();var _1197=oThis.getScrollTop();var _1198=oThis.getAbsoluteX();var _1199=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_1196-_1198,diffY+_1197-_1199,null);if(line!==null){line.onContextMenu(diffX+_1196-_1198,diffY+_1197-_1199);}else{oThis.onContextMenu(diffX+_1196-_1198,diffY+_1197-_1199);}};this.html.oncontextmenu=function(){return false;};var oThis=this;var _119c=function(event){var ctrl=event.ctrlKey;oThis.onKeyDown(event.keyCode,ctrl);};var _119f=function(){var _11a0=arguments[0]||window.event;if(_11a0.returnValue==false){return;}var diffX=_11a0.clientX;var diffY=_11a0.clientY;var _11a3=oThis.getScrollLeft();var _11a4=oThis.getScrollTop();var _11a5=oThis.getAbsoluteX();var _11a6=oThis.getAbsoluteY();oThis.onMouseDown(diffX+_11a3-_11a5,diffY+_11a4-_11a6);};var _11a7=function(){var _11a8=arguments[0]||window.event;if(oThis.currentMenu!==null){oThis.removeFigure(oThis.currentMenu);oThis.currentMenu=null;}if(_11a8.button==2){return;}var diffX=_11a8.clientX;var diffY=_11a8.clientY;var _11ab=oThis.getScrollLeft();var _11ac=oThis.getScrollTop();var _11ad=oThis.getAbsoluteX();var _11ae=oThis.getAbsoluteY();oThis.onMouseUp(diffX+_11ab-_11ad,diffY+_11ac-_11ae);};var _11af=function(){var _11b0=arguments[0]||window.event;var diffX=_11b0.clientX;var diffY=_11b0.clientY;var _11b3=oThis.getScrollLeft();var _11b4=oThis.getScrollTop();var _11b5=oThis.getAbsoluteX();var _11b6=oThis.getAbsoluteY();oThis.currentMouseX=diffX+_11b3-_11b5;oThis.currentMouseY=diffY+_11b4-_11b6;var obj=oThis.getBestFigure(oThis.currentMouseX,oThis.currentMouseY);if(Drag.currentHover!==null&&obj===null){var _11b8=new DragDropEvent();_11b8.initDragDropEvent("mouseleave",false,oThis);Drag.currentHover.dispatchEvent(_11b8);}else{var diffX=_11b0.clientX;var diffY=_11b0.clientY;var _11b3=oThis.getScrollLeft();var _11b4=oThis.getScrollTop();var _11b5=oThis.getAbsoluteX();var _11b6=oThis.getAbsoluteY();oThis.onMouseMove(diffX+_11b3-_11b5,diffY+_11b4-_11b6);}if(obj===null){Drag.currentHover=null;}if(oThis.tooltip!==null){if(Math.abs(oThis.currentTooltipX-oThis.currentMouseX)>10||Math.abs(oThis.currentTooltipY-oThis.currentMouseY)>10){oThis.showTooltip(null);}}};var _11b9=function(_11ba){var _11ba=arguments[0]||window.event;var diffX=_11ba.clientX;var diffY=_11ba.clientY;var _11bd=oThis.getScrollLeft();var _11be=oThis.getScrollTop();var _11bf=oThis.getAbsoluteX();var _11c0=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_11bd-_11bf,diffY+_11be-_11c0,null);if(line!==null){line.onDoubleClick();}};if(this.html.addEventListener){this.html.addEventListener("contextmenu",_1192,false);this.html.addEventListener("mousemove",_11af,false);this.html.addEventListener("mouseup",_11a7,false);this.html.addEventListener("mousedown",_119f,false);this.html.addEventListener("keydown",_119c,false);this.html.addEventListener("dblclick",_11b9,false);}else{if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",_1192);this.html.attachEvent("onmousemove",_11af);this.html.attachEvent("onmousedown",_119f);this.html.attachEvent("onmouseup",_11a7);this.html.attachEvent("onkeydown",_119c);this.html.attachEvent("ondblclick",_11b9);}else{throw "Open-jACOB Draw2D not supported in this browser.";}}}}catch(e){pushErrorStack(e,"Workflow=function(/*:String*/id)");}};Workflow.prototype=new Canvas();Workflow.prototype.type="Workflow";Workflow.COLOR_GREEN=new Color(0,255,0);Workflow.prototype.clear=function(){this.scrollTo(0,0,true);this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;var _11c2=this.getDocument();var _11c3=_11c2.getLines().clone();for(var i=0;i<_11c3.getSize();i++){(new CommandDelete(_11c3.get(i))).execute();}var _11c5=_11c2.getFigures().clone();for(var i=0;i<_11c5.getSize();i++){(new CommandDelete(_11c5.get(i))).execute();}this.commonPorts.removeAllElements();this.dropTargets.removeAllElements();this.compartments.removeAllElements();this.selectionListeners.removeAllElements();this.dialogs.removeAllElements();this.commandStack=new CommandStack();this.currentSelection=null;this.currentMenu=null;Drag.clearCurrent();};Workflow.prototype.onScroll=function(){var _11c6=this.getScrollLeft();var _11c7=this.getScrollTop();var _11c8=_11c6-this.oldScrollPosLeft;var _11c9=_11c7-this.oldScrollPosTop;for(var i=0;i<this.figures.getSize();i++){var _11cb=this.figures.get(i);if(_11cb.hasFixedPosition&&_11cb.hasFixedPosition()==true){_11cb.setPosition(_11cb.getX()+_11c8,_11cb.getY()+_11c9);}}this.oldScrollPosLeft=_11c6;this.oldScrollPosTop=_11c7;};Workflow.prototype.setPanning=function(flag){this.panning=flag;if(flag){this.html.style.cursor="move";}else{this.html.style.cursor="default";}};Workflow.prototype.scrollTo=function(x,y,fast){if(fast){this.scrollArea.scrollLeft=x;this.scrollArea.scrollTop=y;}else{var steps=40;var xStep=(x-this.getScrollLeft())/steps;var yStep=(y-this.getScrollTop())/steps;var oldX=this.getScrollLeft();var oldY=this.getScrollTop();for(var i=0;i<steps;i++){this.scrollArea.scrollLeft=oldX+(xStep*i);this.scrollArea.scrollTop=oldY+(yStep*i);}}};Workflow.prototype.showTooltip=function(_11d6,_11d7){if(this.tooltip!==null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1;}}this.tooltip=_11d6;if(this.tooltip!==null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var oThis=this;var _11d9=function(){oThis.tooltipTimer=-1;oThis.showTooltip(null);};if(_11d7==true){this.tooltipTimer=window.setTimeout(_11d9,5000);}}};Workflow.prototype.showDialog=function(_11da,xPos,yPos){if(xPos){this.addFigure(_11da,xPos,yPos);}else{this.addFigure(_11da,200,100);}this.dialogs.add(_11da);};Workflow.prototype.showMenu=function(menu,xPos,yPos){if(this.menu!==null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow();}this.menu=menu;if(this.menu!==null){this.menu.setWorkflow(this);this.menu.setPosition(xPos,yPos);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint();}};Workflow.prototype.onContextMenu=function(x,y){var menu=this.getContextMenu();if(menu!==null){this.showMenu(menu,x,y);}};Workflow.prototype.getContextMenu=function(){return null;};Workflow.prototype.setToolWindow=function(_11e3,x,y){this.toolPalette=_11e3;if(y){this.addFigure(_11e3,x,y);}else{this.addFigure(_11e3,20,20);}this.dialogs.add(_11e3);};Workflow.prototype.setSnapToGrid=function(flag){if(flag){this.snapToGridHelper=new SnapToGrid(this);}else{this.snapToGridHelper=null;}};Workflow.prototype.setSnapToGeometry=function(flag){if(flag){this.snapToGeometryHelper=new SnapToGeometry(this);}else{this.snapToGeometryHelper=null;}};Workflow.prototype.setGridWidth=function(dx,dy){this.gridWidthX=dx;this.gridWidthY=dy;};Workflow.prototype.addFigure=function(_11ea,xPos,yPos){try{Canvas.prototype.addFigure.call(this,_11ea,xPos,yPos,true);_11ea.setWorkflow(this);var _11ed=this;if(_11ea instanceof CompartmentFigure){this.compartments.add(_11ea);}if(_11ea instanceof Line){this.lines.add(_11ea);}else{this.figures.add(_11ea);_11ea.draggable.addEventListener("drag",function(_11ee){var _11ef=_11ed.getFigure(_11ee.target.element.id);if(_11ef===null){return;}if(_11ef.isSelectable()==false){return;}_11ed.moveResizeHandles(_11ef);});}_11ea.paint();this.setDocumentDirty();}catch(e){pushErrorStack(e,"Workflow.prototype.addFigure=function(/*:Figure*/ figure ,/*:int*/ xPos, /*:int*/ yPos)");}};Workflow.prototype.removeFigure=function(_11f0){Canvas.prototype.removeFigure.call(this,_11f0);this.figures.remove(_11f0);this.lines.remove(_11f0);this.dialogs.remove(_11f0);_11f0.setWorkflow(null);if(_11f0 instanceof CompartmentFigure){this.compartments.remove(_11f0);}if(_11f0 instanceof Connection){_11f0.disconnect();}if(this.currentSelection==_11f0){this.setCurrentSelection(null);}this.setDocumentDirty();_11f0.onRemove(this);};Workflow.prototype.moveFront=function(_11f1){this.html.removeChild(_11f1.getHTMLElement());this.html.appendChild(_11f1.getHTMLElement());};Workflow.prototype.moveBack=function(_11f2){this.html.removeChild(_11f2.getHTMLElement());this.html.insertBefore(_11f2.getHTMLElement(),this.html.firstChild);};Workflow.prototype.getBestCompartmentFigure=function(x,y,_11f5){var _11f6=null;for(var i=0;i<this.figures.getSize();i++){var _11f8=this.figures.get(i);if((_11f8 instanceof CompartmentFigure)&&_11f8.isOver(x,y)==true&&_11f8!=_11f5){if(_11f6===null){_11f6=_11f8;}else{if(_11f6.getZOrder()<_11f8.getZOrder()){_11f6=_11f8;}}}}return _11f6;};Workflow.prototype.getBestFigure=function(x,y,_11fb){var _11fc=null;for(var i=0;i<this.figures.getSize();i++){var _11fe=this.figures.get(i);if(_11fe.isOver(x,y)==true&&_11fe!=_11fb){if(_11fc===null){_11fc=_11fe;}else{if(_11fc.getZOrder()<_11fe.getZOrder()){_11fc=_11fe;}}}}return _11fc;};Workflow.prototype.getBestLine=function(x,y,_1201){var _1202=null;var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.containsPoint(x,y)==true&&line!=_1201){if(_1202===null){_1202=line;}else{if(_1202.getZOrder()<line.getZOrder()){_1202=line;}}}}return _1202;};Workflow.prototype.getFigure=function(id){for(var i=0;i<this.figures.getSize();i++){var _1208=this.figures.get(i);if(_1208.id==id){return _1208;}}return null;};Workflow.prototype.getFigures=function(){return this.figures;};Workflow.prototype.getDocument=function(){return new CanvasDocument(this);};Workflow.prototype.addSelectionListener=function(w){if(w!==null){if(w.onSelectionChanged){this.selectionListeners.add(w);}else{throw "Object doesn't implement required callback method [onSelectionChanged]";}}};Workflow.prototype.removeSelectionListener=function(w){this.selectionListeners.remove(w);};Workflow.prototype.setCurrentSelection=function(_120b){if(_120b===null||this.currentSelection!=_120b){this.hideResizeHandles();this.hideLineResizeHandles();}this.currentSelection=_120b;for(var i=0;i<this.selectionListeners.getSize();i++){var w=this.selectionListeners.get(i);if(w.onSelectionChanged){w.onSelectionChanged(this.currentSelection,this.currentSelection?this.currentSelection.getModel():null);}}if(_120b instanceof Line){this.showLineResizeHandles(_120b);if(!(_120b instanceof Connection)){this.draggingLineCommand=line.createCommand(new EditPolicy(EditPolicy.MOVE));if(this.draggingLineCommand!==null){this.draggingLine=_120b;}}}};Workflow.prototype.getCurrentSelection=function(){return this.currentSelection;};Workflow.prototype.getLine=function(id){var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.getId()==id){return line;}}return null;};Workflow.prototype.getLines=function(){return this.lines;};Workflow.prototype.registerPort=function(port){port.draggable.targets=this.dropTargets;this.commonPorts.add(port);this.dropTargets.add(port.dropable);};Workflow.prototype.unregisterPort=function(port){port.draggable.targets=null;this.commonPorts.remove(port);this.dropTargets.remove(port.dropable);};Workflow.prototype.getCommandStack=function(){return this.commandStack;};Workflow.prototype.showConnectionLine=function(x1,y1,x2,y2){this.connectionLine.setStartPoint(x1,y1);this.connectionLine.setEndPoint(x2,y2);if(this.connectionLine.canvas===null){Canvas.prototype.addFigure.call(this,this.connectionLine);}};Workflow.prototype.hideConnectionLine=function(){if(this.connectionLine.canvas!==null){Canvas.prototype.removeFigure.call(this,this.connectionLine);}};Workflow.prototype.showLineResizeHandles=function(_1218){var _1219=this.resizeHandleStart.getWidth()/2;var _121a=this.resizeHandleStart.getHeight()/2;var _121b=_1218.getStartPoint();var _121c=_1218.getEndPoint();Canvas.prototype.addFigure.call(this,this.resizeHandleStart,_121b.x-_1219,_121b.y-_1219);Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,_121c.x-_1219,_121c.y-_1219);this.resizeHandleStart.setCanDrag(_1218.isResizeable());this.resizeHandleEnd.setCanDrag(_1218.isResizeable());if(_1218.isResizeable()){this.resizeHandleStart.setBackgroundColor(Workflow.COLOR_GREEN);this.resizeHandleEnd.setBackgroundColor(Workflow.COLOR_GREEN);this.resizeHandleStart.draggable.targets=this.dropTargets;this.resizeHandleEnd.draggable.targets=this.dropTargets;}else{this.resizeHandleStart.setBackgroundColor(null);this.resizeHandleEnd.setBackgroundColor(null);}};Workflow.prototype.hideLineResizeHandles=function(){if(this.resizeHandleStart.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);}if(this.resizeHandleEnd.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd);}};Workflow.prototype.showResizeHandles=function(_121d){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=_121d){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01);}var _121e=this.resizeHandle1.getWidth();var _121f=this.resizeHandle1.getHeight();var _1220=_121d.getHeight();var _1221=_121d.getWidth();var xPos=_121d.getX();var yPos=_121d.getY();Canvas.prototype.addFigure.call(this,this.resizeHandle1,xPos-_121e,yPos-_121f);Canvas.prototype.addFigure.call(this,this.resizeHandle3,xPos+_1221,yPos-_121f);Canvas.prototype.addFigure.call(this,this.resizeHandle5,xPos+_1221,yPos+_1220);Canvas.prototype.addFigure.call(this,this.resizeHandle7,xPos-_121e,yPos+_1220);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(_121d.isResizeable());this.resizeHandle3.setCanDrag(_121d.isResizeable());this.resizeHandle5.setCanDrag(_121d.isResizeable());this.resizeHandle7.setCanDrag(_121d.isResizeable());if(_121d.isResizeable()){var green=new Color(0,255,0);this.resizeHandle1.setBackgroundColor(green);this.resizeHandle3.setBackgroundColor(green);this.resizeHandle5.setBackgroundColor(green);this.resizeHandle7.setBackgroundColor(green);}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null);}if(_121d.isStrechable()&&_121d.isResizeable()){this.resizeHandle2.setCanDrag(_121d.isResizeable());this.resizeHandle4.setCanDrag(_121d.isResizeable());this.resizeHandle6.setCanDrag(_121d.isResizeable());this.resizeHandle8.setCanDrag(_121d.isResizeable());Canvas.prototype.addFigure.call(this,this.resizeHandle2,xPos+(_1221/2)-this.resizeHandleHalfWidth,yPos-_121f);Canvas.prototype.addFigure.call(this,this.resizeHandle4,xPos+_1221,yPos+(_1220/2)-(_121f/2));Canvas.prototype.addFigure.call(this,this.resizeHandle6,xPos+(_1221/2)-this.resizeHandleHalfWidth,yPos+_1220);Canvas.prototype.addFigure.call(this,this.resizeHandle8,xPos-_121e,yPos+(_1220/2)-(_121f/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8);}};Workflow.prototype.hideResizeHandles=function(){if(this.resizeHandle1.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle1);}if(this.resizeHandle2.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle2);}if(this.resizeHandle3.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle3);}if(this.resizeHandle4.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle4);}if(this.resizeHandle5.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle5);}if(this.resizeHandle6.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle6);}if(this.resizeHandle7.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle7);}if(this.resizeHandle8.canvas!==null){Canvas.prototype.removeFigure.call(this,this.resizeHandle8);}};Workflow.prototype.moveResizeHandles=function(_1225){var _1226=this.resizeHandle1.getWidth();var _1227=this.resizeHandle1.getHeight();var _1228=_1225.getHeight();var _1229=_1225.getWidth();var xPos=_1225.getX();var yPos=_1225.getY();this.resizeHandle1.setPosition(xPos-_1226,yPos-_1227);this.resizeHandle3.setPosition(xPos+_1229,yPos-_1227);this.resizeHandle5.setPosition(xPos+_1229,yPos+_1228);this.resizeHandle7.setPosition(xPos-_1226,yPos+_1228);if(_1225.isStrechable()){this.resizeHandle2.setPosition(xPos+(_1229/2)-this.resizeHandleHalfWidth,yPos-_1227);this.resizeHandle4.setPosition(xPos+_1229,yPos+(_1228/2)-(_1227/2));this.resizeHandle6.setPosition(xPos+(_1229/2)-this.resizeHandleHalfWidth,yPos+_1228);this.resizeHandle8.setPosition(xPos-_1226,yPos+(_1228/2)-(_1227/2));}};Workflow.prototype.onMouseDown=function(x,y){this.dragging=true;this.mouseDownPosX=x;this.mouseDownPosY=y;if(this.toolPalette!==null&&this.toolPalette.getActiveTool()!==null){this.toolPalette.getActiveTool().execute(x,y);}this.showMenu(null);var line=this.getBestLine(x,y);if(line!==null&&line.isSelectable()){this.setCurrentSelection(line);}else{this.setCurrentSelection(null);}};Workflow.prototype.onMouseUp=function(x,y){this.dragging=false;if(this.draggingLineCommand!==null){this.getCommandStack().execute(this.draggingLineCommand);this.draggingLine=null;this.draggingLineCommand=null;}};Workflow.prototype.onMouseMove=function(x,y){if(this.dragging===true&&this.draggingLine!==null){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+diffX;this.draggingLine.startY=this.draggingLine.getStartY()+diffY;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+diffX,this.draggingLine.getEndY()+diffY);this.mouseDownPosX=x;this.mouseDownPosY=y;this.showLineResizeHandles(this.currentSelection);}else{if(this.dragging===true&&this.panning===true){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-diffX,this.getScrollTop()-diffY,true);this.onScroll();}}};Workflow.prototype.onKeyDown=function(_1235,ctrl){if(_1235==46&&this.currentSelection!==null){this.commandStack.execute(this.currentSelection.createCommand(new EditPolicy(EditPolicy.DELETE)));}else{if(_1235==90&&ctrl){this.commandStack.undo();}else{if(_1235==89&&ctrl){this.commandStack.redo();}}}};Workflow.prototype.setDocumentDirty=function(){try{for(var i=0;i<this.dialogs.getSize();i++){var d=this.dialogs.get(i);if(d!==null&&d.onSetDocumentDirty){d.onSetDocumentDirty();}}if(this.snapToGeometryHelper!==null){this.snapToGeometryHelper.onSetDocumentDirty();}if(this.snapToGridHelper!==null){this.snapToGridHelper.onSetDocumentDirty();}}catch(e){pushErrorStack(e,"Workflow.prototype.setDocumentDirty=function()");}};Workflow.prototype.snapToHelper=function(_1239,pos){if(this.snapToGeometryHelper!==null){if(_1239 instanceof ResizeHandle){var _123b=_1239.getSnapToGridAnchor();pos.x+=_123b.x;pos.y+=_123b.y;var _123c=new Point(pos.x,pos.y);var _123d=_1239.getSnapToDirection();var _123e=this.snapToGeometryHelper.snapPoint(_123d,pos,_123c);if((_123d&SnapToHelper.EAST_WEST)&&!(_123e&SnapToHelper.EAST_WEST)){this.showSnapToHelperLineVertical(_123c.x);}else{this.hideSnapToHelperLineVertical();}if((_123d&SnapToHelper.NORTH_SOUTH)&&!(_123e&SnapToHelper.NORTH_SOUTH)){this.showSnapToHelperLineHorizontal(_123c.y);}else{this.hideSnapToHelperLineHorizontal();}_123c.x-=_123b.x;_123c.y-=_123b.y;return _123c;}else{var _123f=new Dimension(pos.x,pos.y,_1239.getWidth(),_1239.getHeight());var _123c=new Dimension(pos.x,pos.y,_1239.getWidth(),_1239.getHeight());var _123d=SnapToHelper.NSEW;var _123e=this.snapToGeometryHelper.snapRectangle(_123f,_123c);if((_123d&SnapToHelper.WEST)&&!(_123e&SnapToHelper.WEST)){this.showSnapToHelperLineVertical(_123c.x);}else{if((_123d&SnapToHelper.EAST)&&!(_123e&SnapToHelper.EAST)){this.showSnapToHelperLineVertical(_123c.getX()+_123c.getWidth());}else{this.hideSnapToHelperLineVertical();}}if((_123d&SnapToHelper.NORTH)&&!(_123e&SnapToHelper.NORTH)){this.showSnapToHelperLineHorizontal(_123c.y);}else{if((_123d&SnapToHelper.SOUTH)&&!(_123e&SnapToHelper.SOUTH)){this.showSnapToHelperLineHorizontal(_123c.getY()+_123c.getHeight());}else{this.hideSnapToHelperLineHorizontal();}}return _123c.getTopLeft();}}else{if(this.snapToGridHelper!==null){var _123b=_1239.getSnapToGridAnchor();pos.x=pos.x+_123b.x;pos.y=pos.y+_123b.y;var _123c=new Point(pos.x,pos.y);this.snapToGridHelper.snapPoint(0,pos,_123c);_123c.x=_123c.x-_123b.x;_123c.y=_123c.y-_123b.y;return _123c;}}return pos;};Workflow.prototype.showSnapToHelperLineHorizontal=function(_1240){if(this.horizontalSnapToHelperLine===null){this.horizontalSnapToHelperLine=new Line();this.horizontalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine);}this.horizontalSnapToHelperLine.setStartPoint(0,_1240);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),_1240);};Workflow.prototype.showSnapToHelperLineVertical=function(_1241){if(this.verticalSnapToHelperLine===null){this.verticalSnapToHelperLine=new Line();this.verticalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine);}this.verticalSnapToHelperLine.setStartPoint(_1241,0);this.verticalSnapToHelperLine.setEndPoint(_1241,this.getHeight());};Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical();};Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!==null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null;}};Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!==null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null;}};